<div class="ref-groups">
  <div class="recommended-group">
    <h1 class="ml-2">New Referral</h1>
      <%= link_to user_path(@recommended_user) do %>
        <div class="recommended-tie-card">
          <% if @recommended_user.photos.attached? %>
            <div class="tie-image-box"> <%= cl_image_tag @recommended_user.photos.first.key, width: 100, height: 100, gravity: :face, crop: :thumb %> </div>
          <% else %>
            <div class="tie-image-box" style="background-image: url('<%= image_path("person_with_hat.jpg", width: 100, height: 100, gravity: :face, crop: :thumb) %>')"> </div>
          <% end %>
          <div class="tie-info-box">
            <div class="tie-texts">
              <h5 class="mb-0"> <%= truncate(@recommended_user.first_name, length:10) %> <%= truncate(@recommended_user.last_name, length:15) %> </h5>
              <!-- Note that below path is there just for demo purposes -->
            </div>
            <div class="tie-interests">
              <% if @recommended_user.interests.present? %>
                <% @recommended_user.interests.each_with_index do |interest, index| %>
                  <% break if index > 2 %>
                  <span class="badge badge-secondary"> <%= interest.name %> </span>
                <% end %>
              <% end %>
            </div>
          <div class="tie-status"><p> <i class="fas fa-lightbulb"></i> <%= @recommended_user.status %> </p></div>
        </div>
      </div>
    <% end %>
  </div>
  <h5 class="ml-2 mr-2">Who would you like to to refer <strong><%= @recommended_user.first_name %></strong> to?</h5>
  <div class="tie-group">
    <% if @users.blank? %>
      <div class="tie-card">
          <div class="no-tie-texts">
            <h6 class="mb-4">You don't have any ties that you can select.</h6>
            <!-- Link path below is incorrect and needs to be updated later on -->
            <%= link_to "Add ties", root_path, class: "primary-button" %>
          </div>
      </div>
    <% else %>
      <% @users.each do |user| %>
        <%= link_to user_path(user) do %>
          <div class="tie-card">
            <% if user.photos.attached? %>
              <div class="tie-image-box"> <%= cl_image_tag user.photos.first.key, width: 100, height: 100, gravity: :face, crop: :thumb %> </div>
            <% else %>
              <div class="tie-image-box" style="background-image: url('<%= image_path("person_with_hat.jpg", width: 100, height: 100, gravity: :face, crop: :thumb) %>')"> </div>
            <% end %>
            <div class="tie-info-box">
              <div class="tie-texts">
                <div class="tie-name">
                  <h5 class="mb-0"> <%= truncate(user.first_name, length:10) %> <%= truncate(user.last_name, length:15) %> </h5>
                </div>
                <!-- 1. If to_user has already been referred to the same person by current_user earlier, do not display -->
                <% if params[:selected_to_user] && params[:selected_to_user].to_i == user.id %>
                  <%= link_to "Unselect", new_referral_path(selected_user: @recommended_user.id), class: "ghost-button mb-0"%>
                <% else %>
                  <%= link_to "Select", new_referral_path(selected_user: @recommended_user.id, selected_to_user: user.id), class: "ghost-button mb-0"%>
                <% end %>
              </div>
              <div class="tie-interests">
                <% if user.interests.present? %>
                  <% user.interests.each_with_index do |interest, index| %>
                    <% break if index > 2 %>
                    <span class="badge badge-secondary"> <%= interest.name %> </span>
                  <% end %>
                <% end %>
              </div>
              <div class="tie-status"><p> <i class="fas fa-lightbulb"></i> <%= user.status %> </p></div>
            </div>
          </div>
        <% end %>
        <!-- If param.selected then show form -->
        <!-- 2 params, selected and id of the selected -->
        <% if params[:selected_to_user].to_i == user.id %>
        <div class="referral-form">
          <%= simple_form_for [ @referral] do |f| %>
            <%= f.input :reason, label: 'Enter some details about your referral' %>
            <%= f.hidden_field :recommended_user_id, value: @recommended_user.id %>
            <%= f.hidden_field :to_user_id, value: user.id %>
            <%= f.button :submit, 'Submit referral', class: "primary-button" %>
          <% end %>
        </div>
        <% end %>
      <% end %>
    <% end %>
    <% @existing_referral_users.each do |user| %>
        <%= link_to user_path(user) do %>
          <div class="tie-card">
            <% if user.photos.attached? %>
              <div class="tie-image-box"> <%= cl_image_tag user.photos.first.key, width: 100, height: 100, gravity: :face, crop: :thumb %> </div>
            <% else %>
              <div class="tie-image-box" style="background-image: url('<%= image_path("person_with_hat.jpg", width: 100, height: 100, gravity: :face, crop: :thumb) %>')"> </div>
            <% end %>
            <div class="tie-info-box">
              <div class="other-tie-texts">
                <h5 class="mb-0"> <%= truncate(user.first_name, length:10) %> <%= truncate(user.last_name, length:15) %> </h5>
                <p class="advice-text"><i class="fas fa-info-circle"></i> You already referred <%= @recommended_user.first_name %> and <%= user.first_name %> to connect</p>
              </div>
              <div class="tie-interests">
                <% if user.interests.present? %>
                  <% user.interests.each_with_index do |interest, index| %>
                    <% break if index > 2 %>
                    <span class="badge badge-secondary"> <%= interest.name %> </span>
                  <% end %>
                <% end %>
              </div>
              <div class="tie-status"><p> <i class="fas fa-lightbulb"></i> <%= user.status %> </p></div>
            </div>
          </div>
        <% end %>
      <% end %>
      <% @existing_ties_users.each do |user| %>
        <%= link_to user_path(user) do %>
          <div class="tie-card">
            <% if user.photos.attached? %>
              <div class="tie-image-box"> <%= cl_image_tag user.photos.first.key, width: 100, height: 100, gravity: :face, crop: :thumb %> </div>
            <% else %>
              <div class="tie-image-box" style="background-image: url('<%= image_path("person_with_hat.jpg", width: 100, height: 100, gravity: :face, crop: :thumb) %>')"> </div>
            <% end %>
            <div class="tie-info-box">
              <div class="other-tie-texts">
                <h5 class="mb-0"> <%= truncate(user.first_name, length:10) %> <%= truncate(user.last_name, length:15) %> </h5>
                <p class="advice-text"><i class="fas fa-info-circle"></i> <%= @recommended_user.first_name %> and <%= user.first_name %> are already ties</p>
              </div>
              <div class="tie-interests">
                <% if user.interests.present? %>
                  <% user.interests.each_with_index do |interest, index| %>
                    <% break if index > 2 %>
                    <span class="badge badge-secondary"> <%= interest.name %> </span>
                  <% end %>
                <% end %>
              </div>
              <div class="tie-status"><p> <i class="fas fa-lightbulb"></i> <%= user.status %> </p></div>
            </div>
          </div>
        <% end %>
  <% end %>
</div>
